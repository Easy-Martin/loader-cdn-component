{"version":3,"file":"loader.cdn.component.umd.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\r\n\r\nfunction systemImport(output, exportName = \"default\") {\r\n  return window.System.import(output).then(module => {\r\n    return module[exportName];\r\n  });\r\n}\r\n\r\nlet loaderCss = {};\r\n\r\nfunction loaderStyle(src) {\r\n  return new Promise((resolve, reject) => {\r\n    if (loaderCss[src]) {\r\n      resolve();\r\n    } else {\r\n      loaderCss[src] = true;\r\n      let link = document.createElement(\"link\");\r\n      link.setAttribute(\"rel\", \"stylesheet\");\r\n      link.setAttribute(\"type\", \"text/css\");\r\n      link.setAttribute(\"href\", src);\r\n      link.addEventListener(\"load\", () => {\r\n        resolve();\r\n      });\r\n      link.addEventListener(\"error\", e => {\r\n        reject(e);\r\n      });\r\n      document.head.appendChild(link);\r\n    }\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * 加载js\r\n * @param {string} name\r\n */\r\nfunction loadScript(src, exportName) {\r\n  return systemImport(src, exportName);\r\n}\r\n\r\nfunction loadComponent({ src, exportName, errorholder = null, placeholder = null }) {\r\n  class LoadWrapComponent extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.state = { C: null, isError: false, loaded: false };\r\n      this.isDone = false;\r\n    }\r\n    componentDidUpdate() {\r\n      const { isError, loaded } = this.state;\r\n      if (loaded && !this.isDone) {\r\n        this.isDone = true;\r\n        if (isError) {\r\n          this.props.loadError && this.props.loadError();\r\n        } else {\r\n          this.props.loadSuccess && this.props.loadSuccess();\r\n        }\r\n      }\r\n    }\r\n    componentDidMount() {\r\n      this.loaderComponent();\r\n    }\r\n    async loaderComponent() {\r\n      try {\r\n        const entry = await loadScript(src, exportName);\r\n        if (entry) {\r\n          this.setState({ C: entry, loaded: true })\r\n        } else {\r\n          this.setState({ isError: true, loaded: true });\r\n        }\r\n      } catch (e) {\r\n        console.error(e);\r\n        this.setState({ isError: true, loaded: true });\r\n      }\r\n    }\r\n    render() {\r\n      const { forwardRef, loadSuccess, ...props } = this.props;\r\n      const { C, isError } = this.state;\r\n      return C ? <C {...props} ref={forwardRef} /> : isError ? <>{errorholder}</> : <>{placeholder}</>;\r\n    }\r\n  }\r\n  return React.forwardRef((props, ref) => <LoadWrapComponent {...props} forwardRef={ref} />);\r\n}\r\n\r\nfunction loadDecComponent({ src, exportName, Component, args, errorholder = null, placeholder = null }) {\r\n  class LoadWrapComponent extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.state = { C: null, isError: false, loaded: false };\r\n      this.isDone = false;\r\n    }\r\n    componentDidUpdate() {\r\n      const { isError, loaded } = this.state;\r\n      if (loaded && !this.isDone) {\r\n        this.isDone = true;\r\n        if (isError) {\r\n          this.props.loadError && this.props.loadError();\r\n        } else {\r\n          this.props.loadSuccess && this.props.loadSuccess();\r\n        }\r\n      }\r\n    }\r\n    async componentDidMount() {\r\n      try {\r\n        const dec = await loadScript(src, exportName);\r\n        dec\r\n          ? this.setState({ C: args ? dec(...args)(Component) : dec(Component), loaded: true })\r\n          : this.setState({\r\n            isError: true,\r\n            loaded: true\r\n          });\r\n      } catch (e) {\r\n        console.error(e);\r\n        //TODO 错误处理\r\n        this.setState({ C: Component, isError: true });\r\n      }\r\n    }\r\n    render() {\r\n      const { forwardRef, loadSuccess, ...props } = this.props;\r\n      const { C, isError } = this.state;\r\n      return C ? <C {...props} ref={forwardRef} /> : isError ? { errorholder } : { placeholder };\r\n    }\r\n  }\r\n  return React.forwardRef((props, ref) => <LoadWrapComponent {...props} forwardRef={ref} />);\r\n}\r\n\r\nconst Loader = {\r\n  loadComponent,\r\n  loadDecComponent,\r\n  loadScript,\r\n  loaderStyle,\r\n};\r\n\r\nexport default Loader;\r\n"],"names":["systemImport","output","exportName","window","System","import","then","module","loaderCss","loaderStyle","src","Promise","resolve","reject","link","document","createElement","setAttribute","addEventListener","e","head","appendChild","loadScript","loadComponent","errorholder","placeholder","LoadWrapComponent","state","C","isError","loaded","isDone","componentDidUpdate","props","loadError","loadSuccess","componentDidMount","loaderComponent","entry","setState","console","error","render","forwardRef","React","Component","ref","loadDecComponent","args","dec","Loader"],"mappings":"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"}