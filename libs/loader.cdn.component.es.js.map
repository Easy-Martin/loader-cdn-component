{"version":3,"file":"loader.cdn.component.es.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\r\n\r\nfunction systemImport(output, exportName = \"default\") {\r\n  return window.System.import(output).then(module => {\r\n    return module[exportName];\r\n  });\r\n}\r\n\r\nlet loaderCss = {};\r\n\r\nfunction loaderStyle(src) {\r\n  return new Promise((resolve, reject) => {\r\n    if (loaderCss[src]) {\r\n      resolve();\r\n    } else {\r\n      loaderCss[src] = true;\r\n      let link = document.createElement(\"link\");\r\n      link.setAttribute(\"rel\", \"stylesheet\");\r\n      link.setAttribute(\"type\", \"text/css\");\r\n      link.setAttribute(\"href\", src);\r\n      link.addEventListener(\"load\", () => {\r\n        resolve();\r\n      });\r\n      link.addEventListener(\"error\", e => {\r\n        reject(e);\r\n      });\r\n      document.head.appendChild(link);\r\n    }\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * 加载js\r\n * @param {string} name\r\n */\r\nfunction loadScript(src, exportName) {\r\n  return systemImport(src, exportName);\r\n}\r\n\r\nfunction loadComponent({ src, exportName, errorholder = null, placeholder = null }) {\r\n  class LoadWrapComponent extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.state = { C: null, isError: false, loaded: false };\r\n      this.isDone = false;\r\n    }\r\n    componentDidUpdate() {\r\n      const { isError, loaded } = this.state;\r\n      if (loaded && !this.isDone) {\r\n        this.isDone = true;\r\n        if (isError) {\r\n          this.props.loadError && this.props.loadError();\r\n        } else {\r\n          this.props.loadSuccess && this.props.loadSuccess();\r\n        }\r\n      }\r\n    }\r\n    componentDidMount() {\r\n      this.loaderComponent();\r\n    }\r\n    async loaderComponent() {\r\n      try {\r\n        const entry = await loadScript(src, exportName);\r\n        if (entry) {\r\n          this.setState({ C: entry, loaded: true })\r\n        } else {\r\n          this.setState({ isError: true, loaded: true });\r\n        }\r\n      } catch (e) {\r\n        console.error(e);\r\n        this.setState({ isError: true, loaded: true });\r\n      }\r\n    }\r\n    render() {\r\n      const { forwardRef, loadSuccess, ...props } = this.props;\r\n      const { C, isError } = this.state;\r\n      return C ? <C {...props} ref={forwardRef} /> : isError ? <>{errorholder}</> : <>{placeholder}</>;\r\n    }\r\n  }\r\n  return React.forwardRef((props, ref) => <LoadWrapComponent {...props} forwardRef={ref} />);\r\n}\r\n\r\nfunction loadDecComponent({ src, exportName, Component, args, errorholder = null, placeholder = null }) {\r\n  class LoadWrapComponent extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.state = { C: null, isError: false, loaded: false };\r\n      this.isDone = false;\r\n    }\r\n    componentDidUpdate() {\r\n      const { isError, loaded } = this.state;\r\n      if (loaded && !this.isDone) {\r\n        this.isDone = true;\r\n        if (isError) {\r\n          this.props.loadError && this.props.loadError();\r\n        } else {\r\n          this.props.loadSuccess && this.props.loadSuccess();\r\n        }\r\n      }\r\n    }\r\n    async componentDidMount() {\r\n      try {\r\n        const dec = await loadScript(src, exportName);\r\n        dec\r\n          ? this.setState({ C: args ? dec(...args)(Component) : dec(Component), loaded: true })\r\n          : this.setState({\r\n            isError: true,\r\n            loaded: true\r\n          });\r\n      } catch (e) {\r\n        console.error(e);\r\n        //TODO 错误处理\r\n        this.setState({ C: Component, isError: true });\r\n      }\r\n    }\r\n    render() {\r\n      const { forwardRef, loadSuccess, ...props } = this.props;\r\n      const { C, isError } = this.state;\r\n      return C ? <C {...props} ref={forwardRef} /> : isError ? { errorholder } : { placeholder };\r\n    }\r\n  }\r\n  return React.forwardRef((props, ref) => <LoadWrapComponent {...props} forwardRef={ref} />);\r\n}\r\n\r\nconst Loader = {\r\n  loadComponent,\r\n  loadDecComponent,\r\n  loadScript,\r\n  loaderStyle,\r\n};\r\n\r\nexport default Loader;\r\n"],"names":["systemImport","output","exportName","window","System","import","then","module","loaderCss","loaderStyle","src","Promise","resolve","reject","link","document","createElement","setAttribute","addEventListener","e","head","appendChild","loadScript","loadComponent","errorholder","placeholder","LoadWrapComponent","state","C","isError","loaded","isDone","componentDidUpdate","props","loadError","loadSuccess","componentDidMount","loaderComponent","entry","setState","console","error","render","forwardRef","React","Component","ref","loadDecComponent","args","dec","Loader"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SAASA,YAAT,CAAsBC,MAAtB,EAA8BC,UAA9B,EAAsD;MAAxBA,UAAwB;IAAxBA,UAAwB,GAAX,SAAW;;;SAC7CC,MAAM,CAACC,MAAP,CAAcC,MAAd,CAAqBJ,MAArB,EAA6BK,IAA7B,CAAkC,UAAAC,MAAM,EAAI;WAC1CA,MAAM,CAACL,UAAD,CAAb;GADK,CAAP;;;AAKF,IAAIM,SAAS,GAAG,EAAhB;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0B;SACjB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;QAClCL,SAAS,CAACE,GAAD,CAAb,EAAoB;MAClBE,OAAO;KADT,MAEO;MACLJ,SAAS,CAACE,GAAD,CAAT,GAAiB,IAAjB;UACII,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAX;MACAF,IAAI,CAACG,YAAL,CAAkB,KAAlB,EAAyB,YAAzB;MACAH,IAAI,CAACG,YAAL,CAAkB,MAAlB,EAA0B,UAA1B;MACAH,IAAI,CAACG,YAAL,CAAkB,MAAlB,EAA0BP,GAA1B;MACAI,IAAI,CAACI,gBAAL,CAAsB,MAAtB,EAA8B,YAAM;QAClCN,OAAO;OADT;MAGAE,IAAI,CAACI,gBAAL,CAAsB,OAAtB,EAA+B,UAAAC,CAAC,EAAI;QAClCN,MAAM,CAACM,CAAD,CAAN;OADF;MAGAJ,QAAQ,CAACK,IAAT,CAAcC,WAAd,CAA0BP,IAA1B;;GAfG,CAAP;;;;;;;;AAyBF,SAASQ,UAAT,CAAoBZ,GAApB,EAAyBR,UAAzB,EAAqC;SAC5BF,YAAY,CAACU,GAAD,EAAMR,UAAN,CAAnB;;;AAGF,SAASqB,aAAT,OAAoF;MAA3Db,GAA2D,QAA3DA,GAA2D;MAAtDR,UAAsD,QAAtDA,UAAsD;8BAA1CsB,WAA0C;MAA1CA,WAA0C,iCAA5B,IAA4B;8BAAtBC,WAAsB;MAAtBA,WAAsB,iCAAR,IAAQ;;MAC5EC,iBAD4E;;;;;iCAElE;;;;YAEPC,KAAL,GAAa;QAAEC,CAAC,EAAE,IAAL;QAAWC,OAAO,EAAE,KAApB;QAA2BC,MAAM,EAAE;OAAhD;YACKC,MAAL,GAAc,KAAd;;;;;;WAEFC,kBAPgF,GAOhF,8BAAqB;wBACS,KAAKL,KADd;UACXE,OADW,eACXA,OADW;UACFC,MADE,eACFA,MADE;;UAEfA,MAAM,IAAI,CAAC,KAAKC,MAApB,EAA4B;aACrBA,MAAL,GAAc,IAAd;;YACIF,OAAJ,EAAa;eACNI,KAAL,CAAWC,SAAX,IAAwB,KAAKD,KAAL,CAAWC,SAAX,EAAxB;SADF,MAEO;eACAD,KAAL,CAAWE,WAAX,IAA0B,KAAKF,KAAL,CAAWE,WAAX,EAA1B;;;KAd0E;;WAkBhFC,iBAlBgF,GAkBhF,6BAAoB;WACbC,eAAL;KAnB8E;;WAqB1EA,eArB0E;;;;;8BAqBhF;;;;;;;;uBAEwBf,UAAU,CAACZ,GAAD,EAAMR,UAAN,CAFlC;;;gBAEUoC,KAFV;;oBAGQA,KAAJ,EAAW;uBACJC,QAAL,CAAc;oBAAEX,CAAC,EAAEU,KAAL;oBAAYR,MAAM,EAAE;mBAAlC;iBADF,MAEO;uBACAS,QAAL,CAAc;oBAAEV,OAAO,EAAE,IAAX;oBAAiBC,MAAM,EAAE;mBAAvC;;;;;;;;;gBAGFU,OAAO,CAACC,KAAR;qBACKF,QAAL,CAAc;kBAAEV,OAAO,EAAE,IAAX;kBAAiBC,MAAM,EAAE;iBAAvC;;;;;;;;OA/B4E;;;;;;;;;WAkChFY,MAlCgF,GAkChF,kBAAS;wBACuC,KAAKT,KAD5C;UACCU,UADD,eACCA,UADD;UACaR,WADb,eACaA,WADb;UAC6BF,KAD7B;;yBAEgB,KAAKN,KAFrB;UAECC,CAFD,gBAECA,CAFD;UAEIC,OAFJ,gBAEIA,OAFJ;aAGAD,CAAC,GAAG,oBAAC,CAAD,eAAOK,KAAP;QAAc,GAAG,EAAEU;SAAtB,GAAuCd,OAAO,GAAG,0CAAGL,WAAH,CAAH,GAAwB,0CAAGC,WAAH,CAA9E;KArC8E;;;IAClDmB,KAAK,CAACC,SAD4C;;SAwC3ED,KAAK,CAACD,UAAN,CAAiB,UAACV,KAAD,EAAQa,GAAR;WAAgB,oBAAC,iBAAD,eAAuBb,KAAvB;MAA8B,UAAU,EAAEa;OAA1D;GAAjB,CAAP;;;AAGF,SAASC,gBAAT,QAAwG;MAA5ErC,GAA4E,SAA5EA,GAA4E;MAAvER,UAAuE,SAAvEA,UAAuE;MAA3D2C,SAA2D,SAA3DA,SAA2D;MAAhDG,IAAgD,SAAhDA,IAAgD;gCAA1CxB,WAA0C;MAA1CA,WAA0C,kCAA5B,IAA4B;gCAAtBC,WAAsB;MAAtBA,WAAsB,kCAAR,IAAQ;;MAChGC,iBADgG;;;;;iCAEtF;;;;aAEPC,KAAL,GAAa;QAAEC,CAAC,EAAE,IAAL;QAAWC,OAAO,EAAE,KAApB;QAA2BC,MAAM,EAAE;OAAhD;aACKC,MAAL,GAAc,KAAd;;;;;;YAEFC,kBAPoG,GAOpG,8BAAqB;yBACS,KAAKL,KADd;UACXE,OADW,gBACXA,OADW;UACFC,MADE,gBACFA,MADE;;UAEfA,MAAM,IAAI,CAAC,KAAKC,MAApB,EAA4B;aACrBA,MAAL,GAAc,IAAd;;YACIF,OAAJ,EAAa;eACNI,KAAL,CAAWC,SAAX,IAAwB,KAAKD,KAAL,CAAWC,SAAX,EAAxB;SADF,MAEO;eACAD,KAAL,CAAWE,WAAX,IAA0B,KAAKF,KAAL,CAAWE,WAAX,EAA1B;;;KAd8F;;YAkB9FC,iBAlB8F;;;;;8BAkBpG;;;;;;;;uBAEsBd,UAAU,CAACZ,GAAD,EAAMR,UAAN,CAFhC;;;gBAEU+C,GAFV;gBAGIA,GAAG,GACC,KAAKV,QAAL,CAAc;kBAAEX,CAAC,EAAEoB,IAAI,GAAGC,GAAG,MAAH,SAAOD,IAAP,EAAaH,SAAb,CAAH,GAA6BI,GAAG,CAACJ,SAAD,CAAzC;kBAAsDf,MAAM,EAAE;iBAA5E,CADD,GAEC,KAAKS,QAAL,CAAc;kBACdV,OAAO,EAAE,IADK;kBAEdC,MAAM,EAAE;iBAFR,CAFJ;;;;;;;gBAOAU,OAAO,CAACC,KAAR,eAVJ;;qBAYSF,QAAL,CAAc;kBAAEX,CAAC,EAAEiB,SAAL;kBAAgBhB,OAAO,EAAE;iBAAvC;;;;;;;;OA9BgG;;;;;;;;;YAiCpGa,MAjCoG,GAiCpG,kBAAS;yBACuC,KAAKT,KAD5C;UACCU,UADD,gBACCA,UADD;UACaR,WADb,gBACaA,WADb;UAC6BF,KAD7B;;yBAEgB,KAAKN,KAFrB;UAECC,CAFD,gBAECA,CAFD;UAEIC,OAFJ,gBAEIA,OAFJ;aAGAD,CAAC,GAAG,oBAAC,CAAD,eAAOK,KAAP;QAAc,GAAG,EAAEU;SAAtB,GAAuCd,OAAO,GAAG;QAAEL,WAAW,EAAXA;OAAL,GAAqB;QAAEC,WAAW,EAAXA;OAA7E;KApCkG;;;IACtEmB,KAAK,CAACC,SADgE;;SAuC/FD,KAAK,CAACD,UAAN,CAAiB,UAACV,KAAD,EAAQa,GAAR;WAAgB,oBAAC,iBAAD,eAAuBb,KAAvB;MAA8B,UAAU,EAAEa;OAA1D;GAAjB,CAAP;;;AAGF,IAAMI,MAAM,GAAG;EACb3B,aAAa,EAAbA,aADa;EAEbwB,gBAAgB,EAAhBA,gBAFa;EAGbzB,UAAU,EAAVA,UAHa;EAIbb,WAAW,EAAXA;CAJF;;;;"}